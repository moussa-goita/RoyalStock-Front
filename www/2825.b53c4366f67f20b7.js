"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2825],{2825:(k,d,s)=>{s.r(d),s.d(d,{BonSortieDetailPage:()=>P});var c=s(177),a=s(4341),o=s(3260),f=s(5079),p=s(5873),t=s(3953),h=s(8465),g=s(9034),m=s(1626);let v=(()=>{var i;class l{constructor(e){this.http=e,this.apiUrl="http://localhost:8080/api/produits"}getProduits(){return this.http.get(this.apiUrl)}getProduitById(e){return this.http.get(`${this.apiUrl}/${e}`)}createProduit(e,r){return this.http.post(`${this.apiUrl}/create?email=${r}`,e)}getProduitsByEntrepot(e){return this.http.get(`${this.apiUrl}/entrepot/${e}`)}updateProduit(e,r){return this.http.put(`${this.apiUrl}/${e}`,r)}deleteProduit(e){return this.http.delete(`${this.apiUrl}/${e}`)}}return(i=l).\u0275fac=function(e){return new(e||i)(t.KVO(m.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),l})(),S=(()=>{var i;class l{constructor(e){this.http=e,this.apiUrl="http://localhost:8080/api/details-sorties"}getDetailSorties(){return this.http.get(this.apiUrl)}getDetailSortieById(e){return this.http.get(`${this.apiUrl}/${e}`)}createDetailSortie(e){return this.http.post(this.apiUrl,e)}updateDetailSortie(e,r){return this.http.put(`${this.apiUrl}/${e}`,r)}deleteDetailSortie(e){return this.http.delete(`${this.apiUrl}/${e}`)}}return(i=l).\u0275fac=function(e){return new(e||i)(t.KVO(m.Qq))},i.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),l})();var b=s(4796);function F(i,l){if(1&i&&(t.j41(0,"ion-select-option",18),t.EFF(1),t.k0s()),2&i){const n=l.$implicit;t.Y8G("value",n),t.R7$(),t.JRh(n.productName)}}function D(i,l){if(1&i){const n=t.RV6();t.j41(0,"div",11)(1,"ion-item")(2,"ion-label",12),t.EFF(3,"Produit"),t.k0s(),t.j41(4,"ion-select",13),t.DNE(5,F,2,2,"ion-select-option",14),t.k0s(),t.nrm(6,"ion-icon",15),t.k0s(),t.j41(7,"ion-item")(8,"ion-label",12),t.EFF(9,"Quantit\xe9"),t.k0s(),t.nrm(10,"ion-input",16),t.k0s(),t.j41(11,"ion-item")(12,"ion-label",12),t.EFF(13,"Prix"),t.k0s(),t.nrm(14,"ion-input",17),t.k0s(),t.j41(15,"ion-button",10),t.bIt("click",function(){const r=t.eBV(n).index,u=t.XpG();return t.Njj(u.removeDetail(r))}),t.EFF(16," Supprimer "),t.k0s()()}if(2&i){const n=l.index,e=t.XpG();t.Y8G("formGroupName",n),t.R7$(5),t.Y8G("ngForOf",e.produits)}}let P=(()=>{var i;class l{constructor(e,r,u,B,E,U,$){this.fb=e,this.route=r,this.router=u,this.bonSortieService=B,this.produitService=E,this.detailSortieService=U,this.authService=$,this.produits=[],this.infoMessage="",this.errorMessage="",this.bonSortieId=0,this.detailForm=this.fb.group({details:this.fb.array([])}),(0,f.a)({qrCode:p.JBo,camera:p.UIk}),this.bonSortieId=+this.route.snapshot.paramMap.get("id"),this.detailForm=this.fb.group({details:this.fb.array([])})}ngOnInit(){this.loadProduits(),this.addDetail(),this.loadBonSortie()}get details(){return this.detailForm.get("details")}loadProduits(){const e=this.authService.currentUserValue;e&&e.entrepot?this.produitService.getProduitsByEntrepot(e.entrepot.entrepotId).subscribe(u=>{0===u.length?(this.infoMessage="Aucun produit trouv\xe9 pour cet Entrep\xf4t.",setTimeout(()=>this.infoMessage="",2e3)):this.produits=u},u=>{console.error("Erreur lors de la r\xe9cup\xe9ration des produits:",u),this.errorMessage="Erreur lors de la r\xe9cup\xe9ration des produits."}):this.errorMessage="Erreur: entrep\xf4t utilisateur non trouv\xe9"}loadBonSortie(){this.bonSortieId&&this.bonSortieService.getBonSortieById(this.bonSortieId).subscribe(e=>{e&&e.detailsSorties&&(this.details.clear(),e.detailsSorties.forEach(r=>{this.addDetail(r)}))},e=>{console.error("Erreur lors de la r\xe9cup\xe9ration du bon de sortie:",e),this.errorMessage="Erreur lors de la r\xe9cup\xe9ration du bon de sortie."})}addDetail(e){this.details.push(this.fb.group({produit:[(null==e?void 0:e.produit)||"",a.k0.required],quantity:[(null==e?void 0:e.quantity)||"",a.k0.required],prix:[(null==e?void 0:e.prix)||"",a.k0.required]}))}removeDetail(e){this.details.removeAt(e)}onSubmit(){this.detailForm.valid?(this.detailForm.value.details.forEach(r=>{r.bonSortie={id:this.bonSortieId},this.detailSortieService.createDetailSortie(r).subscribe(()=>{})}),this.router.navigate(["/bon-sortie-list"])):this.errorMessage="Veuillez remplir tous les champs requis."}onCancel(){this.router.navigate(["/bon-sortie-list"])}}return(i=l).\u0275fac=function(e){return new(e||i)(t.rXU(a.ok),t.rXU(h.nX),t.rXU(h.Ix),t.rXU(g.v),t.rXU(v),t.rXU(S),t.rXU(b.u))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-bon-sortie-detail"]],standalone:!0,features:[t.aNF],decls:24,vars:5,consts:[[3,"translucent"],["slot","start"],[3,"fullscreen"],["collapse","condense"],["size","large"],[3,"ngSubmit","formGroup"],["formArrayName","details"],["class","ion-margin-top",3,"formGroupName",4,"ngFor","ngForOf"],["expand","full","color","secondary","type","button",3,"click"],["expand","full","color","primary","type","submit",3,"disabled"],["expand","full","color","danger",3,"click"],[1,"ion-margin-top",3,"formGroupName"],["position","floating"],["formControlName","produit","placeholder","S\xe9lectionnez un produit","fill","outline"],[3,"value",4,"ngFor","ngForOf"],["name","camera","slot","end"],["formControlName","quantity","type","number","min","1","placeholder","Quantit\xe9","fill","outline"],["formControlName","prix","type","number","min","0","placeholder","Prix","fill","outline"],[3,"value"]],template:function(e,r){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Formulaire D\xe9tail"),t.k0s(),t.j41(4,"ion-buttons",1),t.nrm(5,"ion-menu-button"),t.k0s()()(),t.j41(6,"ion-content",2)(7,"ion-header",3)(8,"ion-toolbar")(9,"ion-title",4),t.EFF(10,"Ajouter D\xe9tail"),t.k0s()()(),t.j41(11,"form",5),t.bIt("ngSubmit",function(){return r.onSubmit()}),t.j41(12,"div",6),t.DNE(13,D,17,2,"div",7),t.k0s(),t.j41(14,"ion-button",8),t.bIt("click",function(){return r.addDetail()}),t.EFF(15," Ajouter D\xe9tail "),t.k0s(),t.j41(16,"ion-button",9),t.EFF(17," Enregistrer "),t.k0s()()(),t.j41(18,"ion-footer")(19,"ion-toolbar")(20,"ion-row")(21,"ion-col")(22,"ion-button",10),t.bIt("click",function(){return r.onCancel()}),t.EFF(23," Annuler "),t.k0s()()()()()),2&e&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(5),t.Y8G("formGroup",r.detailForm),t.R7$(2),t.Y8G("ngForOf",r.details.controls),t.R7$(3),t.Y8G("disabled",!r.detailForm.valid))},dependencies:[c.MD,c.Sq,o.Jm,o.QW,o.MC,o.W9,o.eU,o.$w,o.uz,o.he,o.Nm,o.Ip,o.BC,o.ai,o.M0,o.ln,o.hU,o.iq,a.X1,a.qT,a.BC,a.cb,a.j4,a.JD,a.$R,a.v8],styles:["ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--border-radius: 19px;--border-width: 1px;--border-color: #050f36}ion-item.ion-margin-bottom[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:16px}ion-header[_ngcontent-%COMP%] + ion-content[_ngcontent-%COMP%]{margin-top:160px}"]}),l})()}}]);